%% White space:
%% sentence parts on separate lines

% TODO: add review
\documentclass[sigconf, 10pt]{acmart}
%\documentclass[sigconf, 10pt, review]{acmart}
% \documentclass[sigconf, 10pt, authordraft]{acmart}
\settopmatter{printfolios=true,printccs=false,printacmref=false}

\def\Title{Small and Versatile vs. Large and Specialized}
% \def\ShortTitle{}
\def\SubTitle{How to design a collection library for exploratory programming?}
\def\PdfTitle{\Title: \SubTitle}
\def\PdfSubject{TODO}
\def\PdfAuthors{{Stefan Marr, Benoit Daloze}}
\def\PdfKeywords{TODO}


\include{scripts/init}


\collabAuthor{bd}{green!60!black}{Benoit}
\collabAuthor{sm}{red}{Stefan}

\usepackage{booktabs} % For formal tables

% Copyright
%\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
\setcopyright{rightsretained}
%\setcopyright{usgov}
%\setcopyright{usgovmixed}
%\setcopyright{cagov}
%\setcopyright{cagovmixed}

\acmDOI{10.475/123_4} % TODO
\acmISBN{123-4567-24-567/08/06} % TODO

%Conference
\acmConference[PX/18]{Programming Experience Workshop}{April 2018}{Nice, France}
\acmYear{2018}
\copyrightyear{2018}

\acmPrice{15.00}
\acmSubmissionID{123-A12-B3}

\begin{document}
\title{\Title}
% \titlenote{Produces the permission block, and
%   copyright information}
\subtitle{\SubTitle}
% \subtitlenote{The full version of the author's guide is available as
%   \texttt{acmart.pdf} document}

\author{Stefan Marr}
\orcid{0000-0001-9059-5180}
\affiliation{
    \department{School of Computing}
    \institution{University of Kent}
    \city{Canterbury}
    \postcode{CT2 7NZ}
    \country{United Kingdom}
}
\email{s.marr@kent.ac.uk}

\author{Benoit Daloze}
\affiliation{
    \department{Institute for System Software}
    \institution{Johannes Kepler University Linz}
    \streetaddress{Altenbergerstra√üe, 69}
    \city{Linz}
    \postcode{4040}
    \country{Austria}
}
\email{benoit.daloze@jku.at}


% The default list of authors is too long for headers.
% \renewcommand{\shortauthors}{B. Trovato et al.}


\begin{abstract}
This paper provides a sample of a \LaTeX\ document which conforms,
somewhat loosely, to the formatting guidelines for
ACM SIG Proceedings.\footnote{This is an abstract footnote}
\end{abstract}

%
% The code below should be generated by the tool at
% http://dl.acm.org/ccs.cfm
% Please copy and paste the code instead of the example below.
%
% TODO
\begin{CCSXML}
<ccs2012>
 <concept>
  <concept_id>10010520.10010553.10010562</concept_id>
  <concept_desc>Computer systems organization~Embedded systems</concept_desc>
  <concept_significance>500</concept_significance>
 </concept>
 <concept>
  <concept_id>10010520.10010575.10010755</concept_id>
  <concept_desc>Computer systems organization~Redundancy</concept_desc>
  <concept_significance>300</concept_significance>
 </concept>
 <concept>
  <concept_id>10010520.10010553.10010554</concept_id>
  <concept_desc>Computer systems organization~Robotics</concept_desc>
  <concept_significance>100</concept_significance>
 </concept>
 <concept>
  <concept_id>10003033.10003083.10003095</concept_id>
  <concept_desc>Networks~Network reliability</concept_desc>
  <concept_significance>100</concept_significance>
 </concept>
</ccs2012>
\end{CCSXML}

% TODO
\ccsdesc[500]{Computer systems organization~Embedded systems}
\ccsdesc[300]{Computer systems organization~Redundancy}
\ccsdesc{Computer systems organization~Robotics}
\ccsdesc[100]{Networks~Network reliability}

% TODO
\keywords{ACM proceedings, \LaTeX, text tagging}

\maketitle


\section{Introduction}

\begin{note}
% Context: What is the broad context of the work? What is the importance of the general research area?
- collection libraries
  essential part of any general purpose language
  - C doesn't have one?

% Inquiry: What problem or question does the paper address? How has this problem or question been addressed by others (if at all)?
- library design has major influence on
  - language style/idioms
  - programmer productivity (assumed)
  - feeling of the language
- as far as we are aware no systematic study

% Approach: What was done that unveiled new knowledge?
- explore design space
  - which aspects need to be considered
  - which design dimensions are there

% Knowledge: What new facts were uncovered? If the research was not results oriented, what new capabilities are enabled by the work?

- reason about design space for a language designed for exploration
 - high flexibility
 - low friction
   - avoid making unnecessary decisions,
   - performance not important
   - problem first needs to be understood
 - interactive program development
 -> live programming

% Grounding: What argument, feasibility proof, artifacts, or results and evaluation support this work?
- argue for feasibility based on existing techniques

% Importance: Why does this work matter?
- collections are complex but essential parts of our languages
  - better understanding will enable more principled design

\end{note}

\section{Collection Libraries in the Wild, A Brief Excursion}

\begin{note}
- having a brief look around, informally, just getting a flavor
 - what collections do they contain
 - how large (num classes/concepts) are libraries
 - any particularly interesting things?

- C/C++ (boost?)
- Java, C\#, Guava, Eclipse Collections

- Ruby, JavaScript, Python

- Dart, Smalltalk, Lisp

- Eiffel, Pascal, Ada, ... other old-school stuff
- Oz, Prolog, Erlang, ... 

- Haskell, ML, Ocam, Ocaml, ...
- other non-conventioanl languages

- which collections are actually used?
 -> there is a 2017 paper on it for Java
 -> ArrayList on top, there are some numbers for a Smalltalk paper

\end{note}

\section{Design Dimensions for Collection Libraries}

\begin{note}
  - language style
    - object-oriented, procedural, functional, ...
  
  - mutability (mutable, immutable)
  - persistence (persistent data structures, just an implementation technique for immutable collections? or does it have a design impact? probably, because of performance aspects)
  - processing of bulk operations (sequential, parallel)


  - Generalization vs. Specialization  
  - small set of generalized collection types 
  - or large set of specialized types
  
  - is small and versatile bad design because it violates the `one thing does   one thing good premise'
    - are those classes blobs? \citep{brown1998antipatterns}
    - do they do too much? is this an issue?
     -> yes, it's an issue, the code is not clear about what kind of 
        interactions one wants to allow on the collection
     -> complexity of implementation is a real issue (concurrency issues,
        strategies, JIT DS...)
     -> this means, it can be a burden for maintaining large systems
     -> it is a burden for VM maintenance
     -> however, The Blob anti-pattern combines complex state and behavior
        such collection design is not a direct instance of it, because
        the contained data is usually still used for a single purpose and
        it is merely that the collections themselves offer too much
        functionality
        
    - drawback of too specialized classes:
      - can become inflexible
        -> need conversion or adapters to perform certain operations
        -> large class hierarchies, hard to chose one, might not even be
           clear what options are available, or appropriate for problem
     
  
  
\end{note}


\section{Techniques for Efficient Implementations}


\begin{note}
Discussion Points:
 


Practical Implementation Concerns
 How to realize all this with same efficiency as when using special purpose
 collections?
 - probably not getting there 100\%, but 90\% or even 80\% are sufficient
   when it improves developer productivity (which still has to be proven of course)
  
 - to get to the 80-90\% mark
  -> strategies (seq, par)
  -> JIT Data Structures
     -> the other paper about collections I saw (something from a german university)
  ->

How to design so that specialized collections remain possible?
And are easily adopted?
 -> ensure subset of collection APIs are polymorphic
   -> ideally, one just changes the constructor, or adds a conversion
   -> idea would be that this gives the last 10-20\% of performance when needed
   -> leave door open for improving performance by restricting flexibility
\end{note}




\section{Related Work}
\sm{not sure we need this section}

\section{Conclusion}



While I have convinced myself
that I do prefer the programming style offered
by a small and versatile collections library,
I cannot shake the feeling
that this is a post hoc justification
for the complexity we add to VMs.

\section{Notes}

\begin{note}
TODO:
- Scala
  - has collection framework with mutable and immutable collections
    -> do they have the same structure 
    -> are immutable collections persistent?
    -> are APIs adapted to facilitate different style?
      -> perhaps not necessary since Scala embraces FP
  - uniform return type principle
  - \url{https://www.scala-lang.org/blog/2017/02/28/collections-rework.html}
 - \url{https://docs.scala-lang.org/overviews/core/architecture-of-scala-collections.html} 
   The Architecture of Scala Collections  

- Goldman Sachs Collections, now Eclipse Collections
\url{https://www.eclipse.org/collections/}
 - mutable and immutable collections
 - specializations for primitive types

- how do templates (expanding ones, as in C++) fit in here?
- compiler-level specialization as with miniboxing?

further reading:

- just in time data structure de wael et al.
- concurrency strategy paper

 - \url{https://www.microsoft.com/en-us/research/publication/bulk-types-with-class/}

 - \url{http://www.cs.ox.ac.uk/people/hongseok.yang/talk/2013-IP2/Lecture12.pdf}
   from \url{http://www.cs.ox.ac.uk/people/hongseok.yang/Public/Courses.html}
 
 - \url{http://web.cecs.pdx.edu/~black/publications/refactoringsACM.pdf}
   Applying Traits to the Smalltalk Collection Classes[/url]
 
 - Storage strategies for collections in dynamically typed languages \citep{Bolz:2013:SSC}

Interfaces and specifications for the Smalltalk-80 collection classes
\url{https://dl.acm.org/citation.cfm?id=141938}


There is also this for C++:
 \url{https://www.youtube.com/watch?v=1-CmNNp5eag}
 \url{http://stepanovpapers.com/stl.ppt}
... but it is ~15 years old.



Dominic:

Perhaps the following paper and thread of work might be relevant here:

* A Comparative Study of Language Support for Generic Programming, Garcia et al. OOPSLA 2003
\url{https://pdfs.semanticscholar.org/1cb3/a5ab80477e3f14e29a23b655a6acfb94957d.pdf}

This paper compared parameterised graph libraries in several languages with static polymorphism: (C++, SML, Haskell, Eiffel, Java, C\#). It was noted that C++ has the abilities to provide type-based refine implementations using the template mechanism, which Haskell could not do. This might be useful for you as it includes more of the OO side.

Perhaps relevant (though not in the OO space) is the following two papers which were motivated by the above:

* Associated Types with Class, Chakravarty et al. POPL 2005
\url{https://pdfs.semanticscholar.org/22d9/fa7835ae91047790dafcd61e30a7d9bd47bd.pdf}

and

* "Associated Type Synonyms" by Chakravarty et al. ICFP 2005.
\url{https://www.microsoft.com/en-us/research/wp-content/uploads/2005/01/at-syns.pdf}

These papers proposed and detailed a new type system feature for GHC/Haskell: primitive recursive type-level functions, motivated by features in C++ that made it more flexible for doing generic collections. I think the first few pages of each paper will be most useful as they explain how this can be used for doing generic collections, and also contain comparison with C++.

Papers potentially for:
 - Eiffel

@inproceedings{odersk2009,
	Address = {Dagstuhl, Germany},
	Author = {Martin Odersky and Adriaan Moors},
	Booktitle = {IARCS Annual Conference on Foundations of Software Technology and Theoretical Computer Science (FSTTCS 2009)},
	Editor = {Ravi Kannan and K Narayan Kumar},
	Pages = {427--451},
	Publisher = {Schloss Dagstuhl--Leibniz-Zentrum {f\"{u}r} Informatik},
	Series = {Leibniz International Proceedings in Informatics (LIPIcs)},
	Title = {Fighting Bit Rot with Types (Experience Report: Scala Collections)},
	Volume = {4},
	Year = {2009}}

@article{krogda2009,
	Author = {Stein Krogdahl and Birger M{\o}ller-Pedersen and Fredrik S{\o}rensen},
	Journal = {JoT},
	Month = {Nov},
	Number = {7},
	Pages = {59-85},
	Title = {Exploring the use of Package Templates for flexible re-use of Collections of related Classes},
	Volume = {8},
	Year = {2009}}
  
  
Newspeak related design questions (by Gilad)
is the map API compatible with single argument closures? It should be; are keys and values lists, and what order guarantees do we get for these, if any? Can lists be seen as maps with integer keys? Do we support slices? External vs. internal iteration? I feel I could keep going for a long time. One can even consider doing APL style vector operations - but that seems to me a whole different language.


Energy profiles of Java collections classes
https://dl.acm.org/citation.cfm?id=2884869

Reducing resource consumption of expandable collections: The Pharo case
- some data on collection use in Pharo
- the interesting bit seems to be on the implementation of Lua tables

https://www.sciencedirect.com/science/article/pii/S0167642317302940

Empirical Study of Usage and Performance of Java Collections
https://dl.acm.org/citation.cfm?id=3030221


CollectionSwitch: A Framework for Efficient and Dynamic Collection Selection
DOI 10.1145/3168825
CGO 2018 (to appear)
% \url{https://www.researchgate.net/publication/322438185_CollectionSwitch_A_Framework_for_Efficient_and_Dynamic_Collection_Selection








\end{note} 


%% ATTIC, Notes on Things Considered, but not included
%% ===================================================

%% Streams
%%
%% finite, or infinite sequence of values
%% aren't collections, just one way to express iteration/transformation

\bibliographystyle{ACM-Reference-Format}
\bibliography{references}

\end{document}
